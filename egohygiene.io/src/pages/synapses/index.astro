---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../../consts';
import { getSynapses } from '../../../../src/models/Synapse';
import SynapseList from '../../components/synapse/SynapseList.astro';
import Pagination from '../../components/synapse/Pagination.astro';
import CategoryCarousel from '../../components/CategoryCarousel.astro';
import { CATEGORY_GROUPS } from '../../data/categories';

const allSynapses = (await getSynapses()).sort(
  (a, b) => new Date(b.created).valueOf() - new Date(a.created).valueOf(),
);
const perPage = 5;
const currentPage = Number(Astro.url.searchParams.get('page') || '1');
const start = (currentPage - 1) * perPage;
const paged = allSynapses.slice(start, start + perPage);
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
    <style>
      main {
        width: 960px;
      }
      .title {
        margin: 0;
        color: rgb(var(--black));
        line-height: 1;
      }
      .date {
        margin: 0;
        color: rgb(var(--gray));
      }
    </style>
  </head>
  <body>
    <Header />
    <main>
      <CategoryCarousel groups={CATEGORY_GROUPS} />
      <section>
        <SynapseList synapses={paged} />
        <Pagination page={currentPage} perPage={perPage} total={allSynapses.length} />
      </section>
    </main>
    <Footer />
  </body>
</html>
